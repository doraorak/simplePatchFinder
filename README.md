# Info
This is a cpp library that uses capstone (https://www.capstone-engine.org) to find start addresses of an unique sequence of instruction mnemonics in a given image (main executable, dylib or a framework)

The search is done in terms of mnemonics (instruction strings like "mov", "str" etc), which means there is no way to search based on instruction operands or immediate values. This is because the tool is meant to be simple.

In order to match instructions generated by capstone from a standalone disassembler, its recommended to use radare2 (https://github.com/radareorg/radare2) because its disassembly engine is also capstone.

# API
```cpp
std::vector<uint64_t> image_findInstructions(const struct mach_header_64* mh, std::vector<const char*>&& targetSequence)
```

- `mh`: image (mach header) to look for the target sequence in. You can pass NULL to search in the main executable

- `targetSequence`: cpp vector of c strings that contains an exact sequence (so the order matters) of string representations (mnemonics) of arm64 instructions. For example "mov" or "bl".
  
- `return`: cpp vector containing start addresses of the found target sequences of instructions (these addresses take ASLR slide into account, so they should be ready for use)

```cpp 
const struct mach_header_64* image_getFromBinaryName(const char* binaryName)
```
- `binaryName`: binary name of the loaded image. For example just "AppKit" for /System/Library/Frameworks/AppKit.framework/Versions/C/AppKit or "libobjc.A.dylib" for /usr/lib/libobjc.A.dylib

- `return`: mach header pointer for the target loaded image

# Dependencies

Depends on capstone library, you can install it via `brew install capstone` for more information see https://www.capstone-engine.org.

The binary in the releases page is statically linked to capstone so it should work standalone without any dependencies.

# Usage

1. download the prebuilt library in the releases page
2. #include "simplePatchFinder.hpp"
3. add the dylib to your projects Libraries & Frameworks section
4. see Example for code snippet

# Example 

see simplePatchFinder-Test. 
```cpp
#include "simplePatchFinder.hpp"
const struct mach_header_64* mh = image_getFromBinaryName("libobjc.A.dylib");
std::vector<uint64_t> addresses = image_findInstructions(mh, {"pacibsp", "stp", "stp"});
//for each address entry in `addresses`, first 3 instructions are "pacibsp", "stp", "stp"
```
